{% extends "base.html" %}

{% block title %}Home | Kuckoo Boo & mama!{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
{% endblock %}

{% block content %}

<!-- HERO SECTION -->
<section class="home-hero">
    <div class="hero-content">
        <h1>Premium Essentials for Babies & Kids</h1>
        <p>Thoughtfully crafted products made with love and care.</p>
        <a href="#products" class="btn-primary">
            Shop Now
        </a>
    </div>
</section>

{% if active_coupon %}
<div class="coupon-banner">
    üéâ Use code 
    <strong>{{ active_coupon.code }}</strong>
    and get
    {% if active_coupon.discount_type == "PERCENT" %}
        {{ active_coupon.discount_value }}% OFF!
    {% elif active_coupon.discount_type == "FLAT" %}
        ‚Çπ {{ active_coupon.discount_value }} OFF!
    {% endif %}
</div>
{% endif %}

<!-- PRODUCTS SECTION -->
<section id="products" class="home-products">

    <div class="section-header">
        <h2>Our Products</h2>
    </div>

    <!-- =========================
         FILTER BAR
    ========================== -->
    <div class="filter-bar">
        <form method="GET" action="{{ url_for('shop.home') }}">

            <!-- Search -->
            <input
                type="text"
                name="search"
                placeholder="Search..."
                value="{{ search_query }}"
            >

            <!-- Category -->
            <select name="category">
                <option value="">All Categories</option>
                {% for cat in categories %}
                    <option value="{{ cat.category }}"
                        {% if selected_category == cat.category %}selected{% endif %}>
                        {{ cat.category }}
                    </option>
                {% endfor %}
            </select>

            <!-- Sort -->
            <select name="sort">
                <option value="">Newest</option>
                <option value="price_low"
                    {% if sort == "price_low" %}selected{% endif %}>
                    Price: Low to High
                </option>
                <option value="price_high"
                    {% if sort == "price_high" %}selected{% endif %}>
                    Price: High to Low
                </option>
            </select>

            <button type="submit" class="btn-filter">
                Apply
            </button>

        </form>
    </div>

    {% if products %}
    <div class="product-grid">

        {% for product in products %}
        <div class="product-card">

            {% if product.is_new %}
                <span class="badge-new">NEW</span>
            {% endif %}

            <!-- MEDIA PREVIEW -->
            <div class="image-wrapper">

                {% if product.preview_image %}
                    <img
                        src="{{ product.preview_image }}"
                        alt="{{ product.name }}"
                        class="product-image"
                        loading="lazy"
                    >
                {% else %}
                    <div class="no-image">
                        No Image
                    </div>
                {% endif %}

            </div>

            <div class="product-info">

                <h3 class="product-title">
                    <a href="{{ url_for('shop.product_detail', product_id=product.id) }}">
                        {{ product.name }}
                    </a>
                </h3>

                <p class="product-description">
                    {{ product.description }}
                </p>

                <p class="product-price">
                    ‚Çπ {{ product.price }}
                </p>

                {% if product.stock > 0 %}
                    <span class="in-stock">
                        In stock: {{ product.stock }}
                    </span>
                {% else %}
                    <span class="out-of-stock">
                        Out of stock
                    </span>
                {% endif %}

                {% if session.get("user_id") and product.stock > 0 %}
                    <form method="POST"
                          action="{{ url_for('cart.add_to_cart', product_id=product.id) }}">
                        <button type="submit" class="btn-add-cart">
                            Add to Cart
                        </button>
                    </form>
                {% endif %}

            </div>

        </div>
        {% endfor %}

    </div>

    <!-- =========================
         PAGINATION
    ========================== -->
    {% if total_pages > 1 %}
    <div class="pagination">

        {% if page > 1 %}
            <a href="{{ url_for('shop.home',
                page=page-1,
                search=search_query,
                category=selected_category,
                sort=sort) }}">
                ‚Üê Previous
            </a>
        {% endif %}

        <span>Page {{ page }} of {{ total_pages }}</span>

        {% if page < total_pages %}
            <a href="{{ url_for('shop.home',
                page=page+1,
                search=search_query,
                category=selected_category,
                sort=sort) }}">
                Next ‚Üí
            </a>
        {% endif %}

    </div>
    {% endif %}

    {% else %}
        <div class="empty-state">
            <p>No products found.</p>
        </div>
    {% endif %}

</section>

{% endblock %}