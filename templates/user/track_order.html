{% extends "base.html" %}
{% block title %}Track Order #{{ order.id }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/track_order.css') }}">
{% endblock %}

{% block content %}

<section class="track-wrapper">

    <div class="track-card">

        <div class="track-header">
            <h1>Track Order #{{ order.id }}</h1>
            <p class="order-date">Placed on {{ order.created_at }}</p>
        </div>

        <div class="status-badges">
            <span class="badge status">{{ order.order_status }}</span>

            <span class="badge {% if order.payment_status == 'PAID' %}paid{% else %}pending{% endif %}">
                {{ order.payment_status }}
            </span>

            <span class="badge method">{{ order.payment_method }}</span>
        </div>

        <hr>

        <!-- ================= CANCELLED STATE ================= -->
        {% if order.order_status == "CANCELLED" %}

            <div class="cancelled-box">
                ‚ùå This order has been cancelled.
            </div>

        {% else %}

        <!-- ================= HORIZONTAL PROGRESS ================= -->
        {% set steps = ["PLACED", "CONFIRMED", "SHIPPED", "DELIVERED"] %}
        {% set current_index = steps.index(order.order_status) if order.order_status in steps else 0 %}

        {% if current_index == 0 %}
            {% set progress_class = "p0" %}
        {% elif current_index == 1 %}
            {% set progress_class = "p33" %}
        {% elif current_index == 2 %}
            {% set progress_class = "p66" %}
        {% else %}
            {% set progress_class = "p100" %}
        {% endif %}

        <div class="progress-container {{ progress_class }}">

            <div class="progress-line">
                <div class="progress-fill"></div>
            </div>

            {% for step in steps %}
            <div class="progress-step">
                <div class="circle {% if steps.index(step) <= current_index %}active{% endif %}"></div>
                <span class="{% if steps.index(step) <= current_index %}active-text{% endif %}">
                    {{ step }}
                </span>
            </div>
            {% endfor %}

        </div>


        <!-- ================= ESTIMATED DELIVERY ================= -->
        {% if order.order_status != "DELIVERED" %}
        <div class="estimated-box">
            üì¶ Estimated Delivery:
            <strong>
                {{ order.estimated_delivery if order.estimated_delivery else "2‚Äì4 business days" }}
            </strong>
        </div>
        {% endif %}

        <!-- ================= SHIPPING TIMELINE ================= -->
        <div class="timeline-section">
            <h3>Shipping Updates</h3>

            {% for event in timeline %}
            <div class="timeline-item">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                    <strong>{{ event.status }}</strong>
                    <p>{{ event.message }}</p>
                    <span class="timeline-time">{{ event.time }}</span>
                </div>
            </div>
            {% endfor %}
        </div>

        {% endif %}

        <div class="back-link">
            <a href="{{ url_for('user.my_orders') }}">‚Üê Back to Orders</a>
        </div>

    </div>

</section>

{% endblock %}
