{% extends "base.html" %}
{% block title %}Your Cart | Kuckoo Boo & mama!{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/cart.css') }}">
{% endblock %}

{% block content %}

<section class="cart-section">

    <h1>Your Cart</h1>

    {% if session.get("cart_error") %}
        <p class="error">{{ session.pop("cart_error") }}</p>
    {% endif %}

    {% if session.get("coupon_message") %}
        <p class="coupon-msg">{{ session.pop("coupon_message") }}</p>
    {% endif %}

    {% if cart %}

    <table class="cart-table">
        <thead>
            <tr>
                <th>Product</th>
                <th>Price</th>
                <th>Qty</th>
                <th>Total</th>
                <th></th>
            </tr>
        </thead>

        <tbody>
            {% for product_id, item in cart.items() %}
            <tr>
                <td>{{ item.name }}</td>
                <td>₹ {{ item.price }}</td>
                <td>
                    <a href="{{ url_for('cart.decrease_quantity', product_id=product_id) }}">−</a>
                    {{ item.quantity }}
                    <a href="{{ url_for('cart.increase_quantity', product_id=product_id) }}">+</a>
                </td>
                <td>₹ {{ item.price * item.quantity }}</td>
                <td>
                    <a href="{{ url_for('cart.remove_from_cart', product_id=product_id) }}">
                        Remove
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- COUPON SECTION -->
    <div class="coupon-section">

        {% if applied_coupon %}
            <p>
                Applied Coupon:
                <strong>{{ applied_coupon.code }}</strong>
                ({{ applied_coupon.discount_percent }}% OFF)
                <a href="{{ url_for('cart.remove_coupon') }}">Remove</a>
            </p>
        {% else %}
            <form method="POST" action="{{ url_for('cart.apply_coupon') }}">
                <input type="text" name="coupon_code" placeholder="Enter coupon code">
                <button type="submit">Apply</button>
            </form>
        {% endif %}

    </div>

    <!-- SUMMARY -->
    <div class="cart-summary">

        <p>Subtotal: ₹ {{ subtotal }}</p>

        {% if discount > 0 %}
            <p>Discount: − ₹ {{ discount }}</p>
        {% endif %}

        <h3>Total: ₹ {{ total }}</h3>

        <a href="{{ url_for('checkout.checkout') }}" class="checkout-btn">
            Proceed to Checkout
        </a>

    </div>

    {% else %}
        <p>Your cart is empty.</p>
        <a href="{{ url_for('shop.home') }}">Continue Shopping</a>
    {% endif %}

</section>

{% endblock %}